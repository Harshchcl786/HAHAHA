pipeline{
        agent any 
        tools
        {
        	maven 'M3'
        	jdk 'java'	
        }
stages{
        stage('Build'){
         steps{
         	sh 'mvn compile'
         }
       }       
       stage('QA with SonarQube')
       {
       		steps{
       			withSonarQubeEnv('sonar'){
       			sh 'mvn clean package sonar:sonar'
       			 }
   			}
       }
      
        stage("Quality Gate Status Check"){
        steps{
          timeout(time: 1, unit: 'HOURS') {
              def qg = waitForQualityGate()
              if (qg.status != 'OK') {
                  error "Pipeline aborted due to quality gate failure"
              }
          }
      }   
    }
 stage('Deploy')
      {
      	steps{
        sh 'ansible-playbook demo.yml'	
       	}
       }  
     }     
  }
